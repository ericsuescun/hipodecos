<div class="recipients">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12 col-sm-12 col-lg-12">
        <% inform.recipients.each do |recipient| %>
          <div class="card bg-light mx-2 mb-3">
            <div class="card-header pl-1 pr-0 pt-0 pb-0 d-flex justify-content-between">

              
              <div class="d-flex align-items-center p-0">
                <span class="d-flex"><strong><%= recipient.tag %></strong>, creado por: <%= User.where(id: recipient.user_id).first.try(:email) %></span>
                
                <%= link_to edit_recipient_path(recipient), remote: true, class: "d-flex my-0 py-0" do %>
                  <span style="font-size: 25px;color: grey;border: 1px solid grey; border-radius: 3px;padding-left: 5px;padding-right: 5px;text-decoration: none;">&#9998;</span>
                <% end %>
              </div>
              <div class="d-flex">
                <% if inform.samples.where(recipient_tag: recipient.tag).count < 1 %>
                  <%= link_to recipient, method: :delete, remote: true, class: "mx-2 my-2 px-2 #{Sample.where(inform_id: inform.id, recipient_tag: recipient.tag).count != 0 ? "disabled" : ""}", style: "color: grey; font-size: 20px;border: 1px solid grey; border-radius: 3px;text-decoration: none;" do %>
                    <span>&times;</span>
                  <% end %>
                <% end %>
                
              </div>

            </div>
              <div class="d-flex flex-row justify-content-between align-items-center">
                
                

              </div>
              
            <div class="card-body elements-in-for-<%= recipient.tag %>">
              <div class="alert alert-secondary">
                <% if recipient.description == nil || edit_recipient_tag == recipient.tag %>
                  <%= form_with model: recipient do |f| %>
                      <div class="field">
                        <%= f.label "Descripción:" %>
                        <%= f.text_area :description, rows: "10", cols: "80", class: "form-control input" %>
                      </div>
                      <div class="actions">
                        <%= f.submit "Guardar", class: "btn btn-warning btn-sm mt-2" %>
                      </div>
                  <% end %>
                <% else %>
                  <p class="card-text"><strong>Descripción:</strong> <%= recipient.description %></p>
                <% end %>
              </div>

              <div class="row recipient-<%= recipient.tag %>">
                <div class="col-12 col-md-12 col-lg-12">
                  <div class="card-deck">
                    <% inform.samples.where(recipient_tag: recipient.tag).each do |sample| %>

                      <% if sample.organ_code == nil %>
                        <div class="col-12 col-md-12 col-lg-12 card-in">
                      <% else %>
                        <div class="col-12 col-lg-3 card-in">
                      <% end %>

                        <div class="card mx-2 my-2 pb-0" id="sample-<%= sample.sample_tag %>" style="background-color: <%= get_color(sample) %>">

                          <div class="card-header pl-1 pr-0 pt-0 pb-0 d-flex justify-content-between">

                            <span class="d-flex "><strong><%= sample.sample_tag %>: <%= sample.fragment %>F</strong></span>

                            <% if sample.slide_tag == nil %>

                              <%= link_to sample, method: :delete, class: "my-0 d-flex px-2", style: "color: grey; font-size: 20px;border: 1px solid grey; border-radius: 3px;text-decoration: none;", remote: true  do %>
                                <span>&times;</span>
                              <% end %>
                            <% end %>

                          </div>

                          <div class="card-body p-1 m-1 sample-card-<%= sample.sample_tag %>">
                            <div class="row">
                              <% if sample.organ_code == nil %>

                                <%= render partial: "informs/organs_choice", locals: { sample: sample } %>
                                
                              <% else %>

                              <% end %> 
                            </div>
                            
                            <h6 class="card-title my-0">Órgano: <%= sample.organ_code %></h6>
                            <%= sample.description %>
                            <% if sample.fragment == nil || sample.description == nil || edit_sample_tag == sample.sample_tag %>
                              <%= form_with model: sample do |f| %>
                                  <div class="field">
                                    <%= f.label "Fragmentos:" %>
                                    <%= f.number_field :fragment, value: sample.fragment != nil ? sample.fragment : 1, class: "form-control input" %>
                                  </div>
                                  <div class="field">
                                    <%= f.label "Descripción:" %>
                                    <%= f.text_area :description, class: "form-control input" %>
                                  </div>
                                  <div class="actions">
                                    <%= f.submit "Guardar", class: "btn btn-warning btn-sm mt-2" %>
                                  </div>
                              <% end %>
                            
                            <% end %>
                            <div id="controls-sample-<%= sample.sample_tag %>">
                              <%= render partial: "samples/sample-controls", locals: { inform: inform, recipient: recipient, sample: sample } %>
                            </div>
                            

                          </div>
                        </div>
                      </div>  
                    <% end %>
                  
                    <div class="col-12 col-lg-3 card-in">
                      <div class="card mx-2 my-2 pb-0">
                        <div class="card-header pt-1 pb-1">
                          <span class="d-flex "><strong>Nuevo Cassette</strong></span>
                        </div>
                        <div class="card-body d-flex justify-content-around">
                          <div class="d-flex flex-column">
                            <h6 class="card-title">Regular</h6>
                            <%= form_with model: [inform, inform.samples.build] do |form| %>
                              <%= form.submit " + ", class: " mx-2 mt-2", style: "padding-left: 10px;padding-right: 10px;font-size: 16px;border: 1px solid grey; border-radius: 3px;background-color: transparent;" %>
                              <%= form.hidden_field :recipient_tag, value: recipient.tag %>
                              <%= form.hidden_field :sample_tag, value: generate_letter_tag(inform) %>
                              <%= form.hidden_field :name, value: "Cassette" %>
                            <% end %>
                          </div>
                          <div class="d-flex flex-column">
                            <h6 class="card-title">Extendido</h6>
                            <%= form_with model: [inform, inform.samples.build] do |form| %>
                              <%= form.submit "+E", class: " mx-2 mt-2", style: "padding-left: 10px;padding-right: 10px;font-size: 16px;border: 1px solid grey; border-radius: 3px;background-color: white;" %>
                              <%= form.hidden_field :recipient_tag, value: recipient.tag %>
                              <%= form.hidden_field :sample_tag, value: generate_letter_tag(inform) %>
                              <%= form.hidden_field :name, value: "Extendido" %>
                            <% end %>
                          </div>
                          
                        </div>
                      </div>
                    </div>

                    

                  </div>

                </div>
              </div>


              
              <div class="row">
                <div class="col-12 col-sm-12 col-lg-12">

                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div class="alert alert-primary pb-0 pt-1">
      
      <div class="row d-flex align-items-center">
        <div class="col-12 col-lg-1 col-xl-1">
          <h4>Rec/Blo</h4>
        </div>
        <div class="col-12 col-lg-4 col-xl-3">
          <!-- <h4>Atajos para recipientes</h4> -->
          <div class="d-flex flex-row">

            <%= form_with url: execute_templates_create_path, method: "get" do |form| %>
              <div class="actions">
                <%= form.submit "+ Rec +1", class: "btn btn-primary mx-1 my-1" %>
                <%= form.hidden_field :inform_id, value: inform.id %>
                <%= form.hidden_field :title, value: "+ Rec +1" %>
              </div>
            <% end %>
            <%= form_with url: execute_templates_create_path, method: "get" do |form| %>
              <div class="actions">
                <%= form.submit "+ Rec +2", class: "btn btn-primary mx-1 my-1" %>
                <%= form.hidden_field :inform_id, value: inform.id %>
                <%= form.hidden_field :title, value: "+ Rec +2" %>
              </div>
            <% end %>
            <%= form_with url: execute_templates_create_path, method: "get" do |form| %>
              <div class="actions">
                <%= form.submit "+ Rec +3", class: "btn btn-primary mx-1 my-1" %>
                <%= form.hidden_field :inform_id, value: inform.id %>
                <%= form.hidden_field :title, value: "+ Rec +3" %>
              </div>
            <% end %>


          </div>
        </div>

        <div class="col-12 col-lg-4 col-xl-3">
          <!-- <h4>Mas atajos</h4> -->
          <%= form_with url: execute_templates_create_path, method: "get" do |form| %>
            
            
            <div class="row d-flex flex-row">
              
              <div class="col-12 col-lg-4 col-xl-3">
                <div class="actions mt-3">
                  <%= form.submit "+ Rec +", class: "btn btn-success" %>
                </div>
              </div>

              <div class="col-12 col-lg-3 col-xl-3">
                <div class="form-group mt-3">
                  <%= form.number_field :samples, value: 4, class: "form-control input" %>
                </div>
              </div>

              <div class="col-12 col-lg-4 col-xl-4">
                <div class="form-group mt-3">
                  <%= form.collection_select(:organ, Organ.all, :organ, :organ, {prompt: 'Órgano'}, { class: "btn btn-success form-control input" }) %>
                </div>
              </div>
              
            </div>
            <%= form.hidden_field :inform_id, value: inform.id %>
            <%= form.hidden_field :title, value: "+ Rec +" %>
            
          <% end %>
        </div>

        <div class="col-12 col-lg-3">
          <!-- Button trigger modal -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#autosMacroModal">
            + Rec + Autos Macro
          </button>
        </div>

      </div>
    </div>

    <%= render partial: "informs/autos_modal", locals: { inform: inform, automatics: automatics } %>

  </div>
</div>

